<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <style>
    /* Set height of the grid so .sidenav can be 100% (adjust as needed) */
    .row.content {height: 550px}
    
    /* Set gray background color and 100% height */
    .sidenav {
      background-color: #f1f1f1;
      height: 100%;
    }
        
    /* On small screens, set height to 'auto' for the grid */
    @media screen and (max-width: 767px) {
      .row.content {height: auto;} 
    }
  </style>
</head>
<body>

<script>

function deleteFile(file_id){
	//var account_id = document.cookie.replace(/(?:(?:^|.*;\s*)account_id\s*\=\s*([^;]*).*$)|^.*$/, "$1");
	$('#spinner').show();
	$.ajax({
        url: "accounts/"+account_id+"/files/"+file_id,
        type: 'DELETE',
        success :function(data) {
        document.getElementById('error').innerHTML="File deleted successfully...!!";
          display_table();
          $('#spinner').hide();
       }
    });
};

function logout(){
	//var account_id = document.cookie.replace(/(?:(?:^|.*;\s*)account_id\s*\=\s*([^;]*).*$)|^.*$/, "$1");
	document.cookie = "firstName=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
	document.cookie = "lastName=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
	document.cookie = "emailId=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
	//document.cookie = "account_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
	//document.cookie = "role=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
};


function updateFile(description){
	document.getElementById('description').value=decodeURIComponent(description);
    document.getElementById('file').focus();
}

function display_table() {
	var firstName = document.cookie.replace(/(?:(?:^|.*;\s*)firstName\s*\=\s*([^;]*).*$)|^.*$/, "$1");
	var lastName = document.cookie.replace(/(?:(?:^|.*;\s*)lastName\s*\=\s*([^;]*).*$)|^.*$/, "$1");
	var emailId = document.cookie.replace(/(?:(?:^|.*;\s*)emailId\s*\=\s*([^;]*).*$)|^.*$/, "$1");
	//document.getElementById('description').value="";
    //document.getElementById('file').value="";
	document.getElementById("displayUser").innerHTML='Welcome ' + firstName +" "+lastName;
	//$("#t01").remove();
	$.ajax({
		type: 'GET',
		url: '/getUserFiles',
		data: { emailId: emailId },
		success: function (data) {
			var jsonResponse = JSON.stringify(data);
			var jsonData = JSON.parse(jsonResponse);
			var display_data = "";
			for (var i = 0; i < jsonData.length; i++) {
				display_data += '<div class="col-sm-4">';
				display_data += '<div class="well">';
				display_data += '<p>Contact Name: ' + jsonData[i].contactName + '<p>';
				display_data += '<p>Email: ' + jsonData[i].contactEmailId + '</p>';
				display_data += '<p>Mobile: ' + jsonData[i].contactNumber + '</p>';
				display_data += '<p>Organization: ' + jsonData[i].organization + '</p>';
				display_data += '<p>Comments: ' + jsonData[i].fileDescription + '</p>';
				//display_data += '<td><button class="download_button" id="' + jsonData[i].fileName + '" type="button" onclick="download(event)">Download</button></td>';
				//display_data += '<td><button class="edit_button" id="' + jsonData[i].fileName + '" type="button" onclick="edit(event)">Edit</button></td>';
				//display_data += '<td><button class="delete_button" id="' + jsonData[i].fileName + '" type="button" onclick="deleteFile(event)">Delete</button></td>';
				//display_data += '</tr>';
				display_data += '</div>';
				display_data += '</div>';
			}
			//$('#t01').append(display_data);
			document.getElementById('t01').innerHTML = display_data;
		},
		error: function (error) {
			var errorjson = JSON.stringify(error);
		}
	});
};

$(document).ready(function () {
	$('#spinner').hide();
	display_table()
});

$(function() {
    $("#upload_file").submit(function(e) {
    	e.preventDefault();
    	//var formData = new FormData(this); 
    	var emailId = document.cookie.replace(/(?:(?:^|.*;\s*)emailId\s*\=\s*([^;]*).*$)|^.*$/, "$1");
    	var firstName = document.cookie.replace(/(?:(?:^|.*;\s*)firstName\s*\=\s*([^;]*).*$)|^.*$/, "$1");
    	var lastName = document.cookie.replace(/(?:(?:^|.*;\s*)lastName\s*\=\s*([^;]*).*$)|^.*$/, "$1");
    	var file = document.getElementById('file').value;
		if (file.lastIndexOf('\\') >= 0){file = file.substr(file.lastIndexOf('\\') + 1);}
		var fileDescription = document.getElementById('description').value;
		var formData = new FormData(this);
		formData.append("firstName", firstName);
		formData.append("lastName", lastName);
		formData.append("emailId", emailId);
		formData.append("fileName", file);
		formData.append("fileDescription", fileDescription);
		
    	$('#spinner').show();
        $.ajax({
            url: "/uploadBusinessCardToS3",
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            enctype: 'multipart/form-data',
        	data: formData,
            success :function(data) {
            	var json = JSON.stringify(data);
            	//alert(data.reason);
            	if(data.status=="true")
            	{document.getElementById('error').innerHTML="File Uploaded Successfully...!!!";}
            	display_table();
            	$('#spinner').hide();
              }
        });
    });
});

</script>

<nav class="navbar navbar-inverse visible-xs">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
      </button>
      <a class="navbar-brand" href="#">Logo</a>
      
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
        <li class="active"><a href="#">Dashboard</a></li>
        <li><a href="#">Age</a></li>
        <li><a href="#">Gender</a></li>
        <li><a href="#">Geo</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container-fluid">
  <div class="row content">
    <div class="col-sm-3 sidenav hidden-xs">
      <h3>Business Card Directory</h3>
      <div align='left'><span style="font-size:150%" id='displayUser'></span></div>
      <ul class="nav nav-pills nav-stacked">
        <li class="active"><a href="#section1">Dashboard</a></li>
        <li><a href="#section2">Profile</a></li>
        <li><a href="#section3">List of cards</a></li>
        <li><a href="#section3">Update</a></li>
        <li><a href=index.html onClick=logout()>
          <span class="glyphicon glyphicon-log-out"></span> Log out
	 </a></li>
      </ul><br>
    </div>
    <br>
    
    <div class="col-sm-9">
      <div class="well">
        <h4>Upload Card Here:</h4>
        <form id="upload_file" method="post" enctype="multipart/form-data">
	 		<p id='error' style="color:green;"></p>
  			<input type="file" name="file" id="file" required><input type="text" name="description" id="description" placeholder="Comments"><button>Upload File</button>
	</form>

	<div id="spinner">
		<img src="ajax-loader.gif" />
	</div>
	
      </div>
      <div class="row" id="t01">
        
      </div>
   
    </div>
  </div>
</div>

</body>
</html>
